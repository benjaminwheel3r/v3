---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
Candidate = "TRUMP"
require(sp)

library(sp)
library(rgdal)
library(RColorBrewer)
library(spdep)
library(lattice)
library(latticeExtra)
library(maptools)
library(tmap)
library(spgwr)
library(GWmodel)

#prevents lat long rounding
options("scipen" = 100)
setwd("C:/Temp/FINAL_INPUTS/Box Sync/R/v4/GWR/GWR_Analysis")
```

```{r}
#reads in Countylayer
co = readOGR(dsn = getwd(),layer = "NY_CNTY",integer64="warn.loss")
df_co = data.frame(co)
spdf_co = SpatialPolygonsDataFrame(co,df_co)

d3 <- read.table("C:/Temp/FINAL_INPUTS/Box Sync/R/v4/v3_AllTags_002_AllSources_analysis_v3_310.csv",
                 header=TRUE, sep=",", na.strings="0", dec=".", strip.white=TRUE)
d3$PopDens <- log(d3$TotPop/d3$SqMiles)
d3$perc_white_comb <- d3$White_and_combination/d3$TotPop
d3$perc_white <- d3$White_only/d3$TotPop
d3$perc_Fem <- d3$FemOver18/d3$PopOver18
#Sorts etc
sp = spdf_co[order(spdf_co$NAME), ]
d3j = d3[order(d3$County), ]

#THis is a dumb intermediate
df1 <- data.frame(d3j[ which(d3j$CANDIDATE==Candidate), ])
outvar = "C:/Temp/FINAL_INPUTS/Box Sync/R/v4/v3_AllTags_002_AllSources_analysis_v3_310_subset.csv"
write.csv(df1,outvar,na="NA")


df = read.table(outvar,header=TRUE, sep=",", na.strings=0, dec=".",strip.white=TRUE)
spdf_co2 = merge(sp,df,by=(intersect(by.x,by.y)),by.x = "NAME", by.y = "County")

#rural <- read.table("C:/Temp/FINAL_INPUTS/Box Sync/R/v4/Data/ruralness/rural.csv",header=TRUE, sep=",", na.strings="NA",na.dec=".", strip.white=TRUE)

#rural.df = rural[order(rural$County), ]
#spdf_co2$LogDens = log((spdf_co2$PopOver18/spdf_co2$ALAND10))
#spdf_co2 = merge(spdf_co2,rural.df,by=(intersect(by.x,by.y)),by.x = "NAME", by.y = "County")


DeVar = "Candidate_VS"
InDeVar= c("Perc_BachelorsDeg_and_higher","perc_Fem","perc_white","PopDens", "MedianAge_Total")
#,  "Candidate_TS17", "Candidate_TS18", "Candidate_TS19b4"

#bandwidth = bw.gwr(spdf_co2$Candidate_VS~spdf_co2$Candidate_TS17 + spdf_co2$Perc_BachelorsDeg_and_higher + #spdf_co2$Candidate_TS_b4, spdf_co2, approach="CV",kernel="bisquare",
#                 adaptive=TRUE, p=2, theta=0, longlat=F,dMat)



model.sel <- gwr.model.selection(DeVar,InDeVar, data=spdf_co2,bw=100,approach="aic",
               adaptive=T,kernel="bisquare",dMat=NULL,p=2, theta=0, longlat=F)
model.list <- model.sel[[1]]
print(model.list)
ruler.vector <- model.sel[[2]][,2]
lvar <- length(InDeVar)
sorted.models <- GWmodel::gwr.model.sort(model.list,1, ruler.vector)  # it might be the number of indevars in each model at each instance... of a model 
#ie, 1 - [1], 2, 2, 3-2, 4 - 2 etc...
 model.list[[2]] <- sorted.models[[1]]
gwr.model.view(DeVar, InDeVar, sorted.models)  # this needs a vector or a list with two different kinds...
gwr.model.
#bandwidth, AIC, AICc, RSS
# need to determine if a model was looking at some of these and how it was determining differences or the best each.
model.sel[[2]]

print(sorted.models)
print(ruler.vector)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).
